# 数据库备份管理

## 查看所有数据库备份列表

### 命令行使用

``` bash
  trove backup-list
```

### 示例

``` bash
  # trove backup-list
  +--------------------------------------+--------------------------------------+----------+-----------+--------------------------------------+---------------------+
  | ID                                   | Instance ID                          | Name     | Status    | Parent ID                            | Updated             |
  +--------------------------------------+--------------------------------------+----------+-----------+--------------------------------------+---------------------+
  | 22ec1d70-7e62-450c-b462-3b55f4b353f0 | a17461ab-6c97-4abf-8890-9f8b10886ecc | back.001 | COMPLETED | None                                 | 2016-12-28T02:23:49 |
  | 8f714e0f-4cfe-45a3-9205-8c933a9a8d4b | a17461ab-6c97-4abf-8890-9f8b10886ecc | base     | COMPLETED | None                                 | 2016-12-28T02:24:13 |
  | 1c8c6038-e2a8-4e48-983b-ac104e93b304 | a17461ab-6c97-4abf-8890-9f8b10886ecc | inc.001  | COMPLETED | 8f714e0f-4cfe-45a3-9205-8c933a9a8d4b | 2016-12-28T02:24:47 |
  +--------------------------------------+--------------------------------------+----------+-----------+--------------------------------------+---------------------+
```

## 查看单个数据库实例所拥有的数据库备份

### 命令行使用

``` bash
  trove backup-list-instance [--limit <limit>] <instance>
```

### 示例

``` bash
  # trove backup-list-instance --limit 2 a17461ab-6c97-4abf-8890-9f8b10886ecc
  +--------------------------------------+---------+-----------+--------------------------------------+---------------------+
  | ID                                   | Name    | Status    | Parent ID                            | Updated             |
  +--------------------------------------+---------+-----------+--------------------------------------+---------------------+
  | 8f714e0f-4cfe-45a3-9205-8c933a9a8d4b | base    | COMPLETED | None                                 | 2016-12-28T02:24:13 |
  | 1c8c6038-e2a8-4e48-983b-ac104e93b304 | inc.001 | COMPLETED | 8f714e0f-4cfe-45a3-9205-8c933a9a8d4b | 2016-12-28T02:24:47 |
  +--------------------------------------+---------+-----------+--------------------------------------+---------------------+
```

## 创建数据库备份

支持全量备份和增量备份，增量备份必须要一个全量备份来作为基础备份。

### 命令行使用

``` bash
  trove backup-create <instance> <name>
                             [--description <description>] [--parent <parent>]
```

### 示例

创建一个全量备份 base

``` bash
  # trove backup-create a17461ab-6c97-4abf-8890-9f8b10886ecc base --description "base backup"
  +-------------+-------------------------------------------------------------------------------------------------+
  | Property    | Value                                                                                           |
  +-------------+-------------------------------------------------------------------------------------------------+
  | created     | 2016-12-30T03:04:56                                                                             |
  | datastore   | {u'version': u'5.5', u'type': u'mysql', u'version_id': u'35b4c566-935c-4606-b077-20b90f2bf5df'} |
  | description | base backup                                                                                     |
  | id          | 3d0a46de-b5e0-4c9e-937f-e87b610961c6                                                            |
  | instance_id | a17461ab-6c97-4abf-8890-9f8b10886ecc                                                            |
  | locationRef | None                                                                                            |
  | name        | base                                                                                            |
  | parent_id   | None                                                                                            |
  | size        | None                                                                                            |
  | status      | NEW                                                                                             |
  | updated     | 2016-12-30T03:04:56                                                                             |
  +-------------+-------------------------------------------------------------------------------------------------+
```

基于全量备份 base 创建一个增量备份 inc.001

``` bash
  # trove backup-create a17461ab-6c97-4abf-8890-9f8b10886ecc inc.001 --description "inc backup inc.001" --parent 3d0a46de-b5e0-4c9e-937f-e87b610961c6
  +-------------+-------------------------------------------------------------------------------------------------+
  | Property    | Value                                                                                           |
  +-------------+-------------------------------------------------------------------------------------------------+
  | created     | 2016-12-30T03:06:41                                                                             |
  | datastore   | {u'version': u'5.5', u'type': u'mysql', u'version_id': u'35b4c566-935c-4606-b077-20b90f2bf5df'} |
  | description | inc backup inc.001                                                                              |
  | id          | 9697e010-ec8d-4881-bccb-cd1b3aac57cf                                                            |
  | instance_id | a17461ab-6c97-4abf-8890-9f8b10886ecc                                                            |
  | locationRef | None                                                                                            |
  | name        | inc.001                                                                                         |
  | parent_id   | 3d0a46de-b5e0-4c9e-937f-e87b610961c6                                                            |
  | size        | None                                                                                            |
  | status      | NEW                                                                                             |
  | updated     | 2016-12-30T03:06:41                                                                             |
  +-------------+-------------------------------------------------------------------------------------------------+
```

## 删除数据库备份

注：若删除一个全量备份，该备份作为了其他的增量备份的 parent，会连带这些增量备份删掉。

### 命令行使用

``` bash
  trove backup-delete <backup>
```

### 示例

``` bash
  # trove backup-delete 3d0a46de-b5e0-4c9e-937f-e87b610961c6
```

## 查看数据库备份详情

### 命令行使用

``` bash
  trove backup-show <backup>
```

### 示例

``` bash
  # trove backup-show af5c746d-fda9-4e7d-b2ab-24857498ec4a
  +-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
  | Property    | Value                                                                                                                                     |
  +-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
  | created     | 2016-12-30T03:09:37                                                                                                                       |
  | datastore   | {u'version': u'5.5', u'type': u'mysql', u'version_id': u'35b4c566-935c-4606-b077-20b90f2bf5df'}                                           |
  | description | base backup                                                                                                                               |
  | id          | af5c746d-fda9-4e7d-b2ab-24857498ec4a                                                                                                      |
  | instance_id | a17461ab-6c97-4abf-8890-9f8b10886ecc                                                                                                      |
  | locationRef | http://obs.eayun.com:9090/swift/v1/database_backups_0cbb58a3a7fd4c1d89e4a5f3b8cc0c76/af5c746d-fda9-4e7d-b2ab-24857498ec4a.xbstream.gz.enc |
  | name        | base                                                                                                                                      |
  | parent_id   | None                                                                                                                                      |
  | size        | 0.1                                                                                                                                       |
  | status      | COMPLETED                                                                                                                                 |
  | updated     | 2016-12-30T03:09:41                                                                                                                       |
  +-------------+-------------------------------------------------------------------------------------------------------------------------------------------+
```
