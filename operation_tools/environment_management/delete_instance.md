# 删除错误云主机

在EayunStack环境运行过程中，可能会出现一些使用nova命令无法删除的错误状态的云主机，此时就需要使用该命令进行强制删除。

> ###### 注意
> 该命令只能在**Controller**节点使用

## 命令格式

```
[controller]# eayunstack manage instance --help
usage: eayunstack manage instance [-h] [-d] [--id ID] [--delete-disk]

Instance Management

optional arguments:
  -h, --help            show this help message and exit
  -d, --delete-instance
                        Delete Instance
  --id ID               Instance ID
  --delete-disk         Delete Instance Disk
```

## 删除一个云主机，同时删除磁盘

>  **注意**
>
>  如果不使用```--delete-disk```选项，默认不删出磁盘。

```
(controller)# eayunstack manage instance -d --id 61e3c1ca-1631-4692-9912-897cff279db8 --delete-disk
[ INFO  ] Starting new HTTP connection (1): 172.16.101.2
[ DEBUG ] "POST /v2.0/tokens HTTP/1.1" 200 3704
[ INFO  ] Starting new HTTP connection (1): 25.0.0.2
[ DEBUG ] "GET /v2/3450135f9faa4d0f9b2eed2f202e7767/servers/61e3c1ca-1631-4692-9912-897cff279db8 HTTP/1.1" 200 1623
Instance "61e3c1ca-1631-4692-9912-897cff279db8" is in "ERROR" status. Do you really want to delete it? [yes/no]: yes
[ INFO  ] (controller) (node-7.eayun.com): Delete instance "61e3c1ca-1631-4692-9912-897cff279db8".
[ INFO  ] (controller) (node-7.eayun.com): Instance "61e3c1ca-1631-4692-9912-897cff279db8" is running, try to destroy it.
[ INFO  ] (controller) (node-7.eayun.com): Destroy instance "61e3c1ca-1631-4692-9912-897cff279db8".
[ INFO  ] (controller) (node-7.eayun.com): Destroy instance "61e3c1ca-1631-4692-9912-897cff279db8" successfully.
[ INFO  ] (controller) (node-7.eayun.com): Delete interface "qbr98e897c0-02" from bridge "qvb98e897c0-02" successfully.
[ INFO  ] (controller) (node-7.eayun.com): Set nic "qbr98e897c0-02" state to down successfully.
[ INFO  ] (controller) (node-7.eayun.com): Delete bridge "qbr98e897c0-02" successfully.
[ INFO  ] (controller) (node-7.eayun.com): Delete ovs port "qvo98e897c0-02" successfully.
[ INFO  ] (controller) (node-7.eayun.com): Delete instance dir on compute node "node-1.eayun.com".
[ INFO  ] (controller) (node-7.eayun.com): Undefine instance on compute node "node-1.eayun.com".
[ INFO  ] (controller) (node-7.eayun.com): Delete port "98e897c0-02a1-493a-9b30-5adac7b325a4".
[ INFO  ] (controller) (node-7.eayun.com): Set disk "7f74fbbd-f9d6-441e-9adc-61fcead5ee93" state to available.
[ INFO  ] (controller) (node-7.eayun.com): Set disk "80cbe8c8-78e9-4f18-a3ea-f555b5a7154d" state to available.
[ INFO  ] (controller) (node-7.eayun.com): Set disk "f631cc53-2621-4cc4-a651-0b651a389490" state to available.
[ INFO  ] (controller) (node-7.eayun.com): Delete disk "7f74fbbd-f9d6-441e-9adc-61fcead5ee93".
This volume in "available" status, do you really want to destroy it? [yes/no]: yes
This volume has some snapshots , if you want to continue, you must delete the snapshots! Delete the snapshots? [yes/no]: yes
[ INFO  ] (controller) (node-7.eayun.com): Deleting snapshot [u'698b81ea-c06d-46d6-9ddc-f6451b5407c9'] ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) snapshots ...
[ INFO  ] (controller) (node-7.eayun.com):    [698b81ea-c06d-46d6-9ddc-f6451b5407c9]Deleting backend snapshot ...
[ INFO  ] Starting new HTTP connection (1): 25.0.0.2
[ INFO  ] Starting new HTTP connection (1): 25.0.0.2
[ INFO  ] (controller) (node-7.eayun.com):    Delete image "8a29334b-a4ec-4df9-b235-b1757389c032".
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [698b81ea-c06d-46d6-9ddc-f6451b5407c9]Updating snapshots table ...
[ INFO  ] (controller) (node-7.eayun.com):    [698b81ea-c06d-46d6-9ddc-f6451b5407c9]Updating snapshot quota ...
[ INFO  ] (controller) (node-7.eayun.com): Deleting volume 7f74fbbd-f9d6-441e-9adc-61fcead5ee93 ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) volume ...
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [7f74fbbd-f9d6-441e-9adc-61fcead5ee93]Updating volumes table ...
[ INFO  ] (controller) (node-7.eayun.com):    [7f74fbbd-f9d6-441e-9adc-61fcead5ee93]Updating volume quota ...
[ INFO  ] (controller) (node-7.eayun.com): Delete disk "80cbe8c8-78e9-4f18-a3ea-f555b5a7154d".
This volume in "available" status, do you really want to destroy it? [yes/no]: yes
This volume has some snapshots , if you want to continue, you must delete the snapshots! Delete the snapshots? [yes/no]: yes
[ INFO  ] (controller) (node-7.eayun.com): Deleting snapshot [u'a1c7ce15-7de2-4e5b-8b1e-fa777b444a06'] ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) snapshots ...
[ INFO  ] (controller) (node-7.eayun.com):    [a1c7ce15-7de2-4e5b-8b1e-fa777b444a06]Deleting backend snapshot ...
[ INFO  ] Starting new HTTP connection (1): 25.0.0.2
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [a1c7ce15-7de2-4e5b-8b1e-fa777b444a06]Updating snapshots table ...
[ INFO  ] (controller) (node-7.eayun.com):    [a1c7ce15-7de2-4e5b-8b1e-fa777b444a06]Updating snapshot quota ...
[ INFO  ] (controller) (node-7.eayun.com): Deleting volume 80cbe8c8-78e9-4f18-a3ea-f555b5a7154d ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) volume ...
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [80cbe8c8-78e9-4f18-a3ea-f555b5a7154d]Updating volumes table ...
[ INFO  ] (controller) (node-7.eayun.com):    [80cbe8c8-78e9-4f18-a3ea-f555b5a7154d]Updating volume quota ...
[ INFO  ] (controller) (node-7.eayun.com): Delete disk "f631cc53-2621-4cc4-a651-0b651a389490".
This volume in "available" status, do you really want to destroy it? [yes/no]: yes
This volume has some snapshots , if you want to continue, you must delete the snapshots! Delete the snapshots? [yes/no]: yes
[ INFO  ] (controller) (node-7.eayun.com): Deleting snapshot [u'3257e1e4-7406-42fb-85ff-4622f32084ad'] ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) snapshots ...
[ INFO  ] (controller) (node-7.eayun.com):    [3257e1e4-7406-42fb-85ff-4622f32084ad]Deleting backend snapshot ...
[ INFO  ] Starting new HTTP connection (1): 25.0.0.2
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [3257e1e4-7406-42fb-85ff-4622f32084ad]Updating snapshots table ...
[ INFO  ] (controller) (node-7.eayun.com):    [3257e1e4-7406-42fb-85ff-4622f32084ad]Updating snapshot quota ...
[ INFO  ] (controller) (node-7.eayun.com): Deleting volume f631cc53-2621-4cc4-a651-0b651a389490 ...
[ INFO  ] (controller) (node-7.eayun.com):    Deleting backend(rbd) volume ...
[ INFO  ] (controller) (node-7.eayun.com):    Updating database ...
[ INFO  ] (controller) (node-7.eayun.com):    [f631cc53-2621-4cc4-a651-0b651a389490]Updating volumes table ...
[ INFO  ] (controller) (node-7.eayun.com):    [f631cc53-2621-4cc4-a651-0b651a389490]Updating volume quota ...
[ INFO  ] (controller) (node-7.eayun.com): Update nova database.
```
